if not game:IsLoaded() then game.Loaded:Wait() end

local Obsidian = loadstring(game:HttpGet("https://raw.githubusercontent.com/deividcomsono/Obsidian/main/Library.lua"))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local State = {
    Combat = {
        Aimbot = false, SilentAim = false, Triggerbot = false, 
        Smoothing = 0.05, FOV = 100, ShowFOV = true, 
        TargetPart = "Head", VisibleCheck = true, TeamCheck = true,
        HitChance = 100, Prediction = 0.165, AutoFire = false
    },
    Visuals = {
        Enabled = false, Boxes = false, Skeletons = false, 
        Names = false, Health = false, Tracers = false, 
        Distance = false, Rainbow = true, Chams = false,
        HeadDots = false, LookLines = false, ViewFOV = 70
    },
    Guns = {
        NoRecoil = false, NoSpread = false, FastReload = false, 
        UnlockSkins = false, RapidFire = false, InfiniteAmmo = false,
        InstaHit = false, LongMelee = false
    },
    Movement = {
        Speed = 16, Jump = 50, InfJump = false, Noclip = false, 
        Fly = false, FlySpeed = 50, Bhop = false, AutoSprint = true
    },
    World = {
        Fullbright = false, NoFog = false, Exposure = 0.5, 
        Gravity = 196.2, CustomTime = false, Time = 12
    }
}

local function InitializeGunMods()
    task.spawn(function()
        while task.wait(1) do
            if State.Guns.UnlockSkins then
                pcall(function()
                    local PlayerData = ReplicatedStorage:FindFirstChild("PlayerData")
                    if PlayerData then
                        local Inventory = PlayerData:FindFirstChild(LocalPlayer.Name)
                        if Inventory then
                            for _, v in pairs(Inventory:GetDescendants()) do
                                if v:IsA("BoolValue") and (v.Name == "Unlocked" or v.Name == "Owned") then
                                    v.Value = true
                                end
                            end
                        end
                    end
                end)
            end
        end
    end)
end

local oldIndex
local oldNamecall

oldIndex = hookmetamethod(game, "__index", function(self, key)
    if not checkcaller() then
        if key == "Clips" and State.Guns.InfiniteAmmo then return 999 end
        if key == "Recoil" and State.Guns.NoRecoil then return 0 end
        if key == "Spread" and State.Guns.NoSpread then return 0 end
    end
    return oldIndex(self, key)
end)

local function IsVisible(part)
    local origin = Camera.CFrame.Position
    local direction = (part.Position - origin).Unit * (part.Position - origin).Magnitude
    local rayParams = RaycastParams.new()
    rayParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    rayParams.FilterType = Enum.RaycastFilterType.Exclude
    local result = Workspace:Raycast(origin, direction, rayParams)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

local function GetTarget()
    local target = nil
    local dist = State.Combat.FOV
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild(State.Combat.TargetPart) then
            if State.Combat.TeamCheck and p.Team == LocalPlayer.Team then continue end
            local pos, onScreen = Camera:WorldToViewportPoint(p.Character[State.Combat.TargetPart].Position)
            if onScreen then
                local mouseDist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
                if mouseDist < dist then
                    if State.Combat.VisibleCheck and not IsVisible(p.Character[State.Combat.TargetPart]) then continue end
                    dist = mouseDist
                    target = p
                end
            end
        end
    end
    return target
end

local ESP_Lines = {}
local FOV_Circle = Drawing.new("Circle")

local function CreateESP(player)
    local line = Drawing.new("Line")
    line.Thickness = 1.5
    ESP_Lines[player] = line
end

local Window = Obsidian.new("DEATHBYTE RIVALS | v4.0")

local TabC = Window:Tab("Combat")
TabC:Section("Main Aimbot")
TabC:Toggle("Aimbot Enabled", function(s) State.Combat.Aimbot = s end)
TabC:Toggle("Silent Aim (Risk)", function(s) State.Combat.SilentAim = s end)
TabC:Slider("Aim Smooth", 1, 100, 5, function(v) State.Combat.Smoothing = v/100 end)
TabC:Slider("Aim FOV", 30, 800, 100, function(v) State.Combat.FOV = v end)
TabC:Dropdown("Target", {"Head", "HumanoidRootPart"}, function(v) State.Combat.TargetPart = v end)

local TabV = Window:Tab("Visuals")
TabV:Toggle("ESP Master", function(s) State.Visuals.Enabled = s end)
TabV:Toggle("Box ESP", function(s) State.Visuals.Boxes = s end)
TabV:Toggle("Rainbow Mode", function(s) State.Visuals.Rainbow = s end)
TabV:Toggle("Show Tracers", function(s) State.Visuals.Tracers = s end)

local TabG = Window:Tab("Skins/Guns")
TabG:Button("UNLOCK ALL SKINS", function() 
    State.Guns.UnlockSkins = true 
    Obsidian:Notification("Skins Spoofed", "All weapons unlocked locally!")
end)
TabG:Section("Weapon Mods")
TabG:Toggle("No Recoil", function(s) State.Guns.NoRecoil = s end)
TabG:Toggle("No Spread", function(s) State.Guns.NoSpread = s end)
TabG:Toggle("Insta-Reload", function(s) State.Guns.FastReload = s end)

local TabM = Window:Tab("Movement")
TabM:Slider("Walkspeed", 16, 150, 16, function(v) State.Movement.Speed = v end)
TabM:Toggle("Infinite Jump", function(s) State.Movement.InfJump = s end)
TabM:Toggle("Noclip", function(s) State.Movement.Noclip = s end)

RunService.RenderStepped:Connect(function()
    local rainbow = Color3.fromHSV(tick() % 5 / 5, 1, 1)
    local espCol = State.Visuals.Rainbow and rainbow or Color3.new(1,1,1)

    FOV_Circle.Visible = State.Combat.ShowFOV
    FOV_Circle.Radius = State.Combat.FOV
    FOV_Circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOV_Circle.Color = espCol

    local target = GetTarget()
    if target and target.Character then
        if State.Combat.Aimbot then
            local aimPos = target.Character[State.Combat.TargetPart].Position
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, aimPos), State.Combat.Smoothing)
        end
    end

    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = State.Movement.Speed
        
        if State.Movement.Noclip then
            for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end

    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            if State.Visuals.Enabled then
                local root = p.Character.HumanoidRootPart
                local screenPos, onScreen = Camera:WorldToViewportPoint(root.Position)

                if State.Visuals.Tracers and onScreen then
                    if not ESP_Lines[p] then CreateESP(p) end
                    local l = ESP_Lines[p]
                    l.Visible = true
                    l.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    l.To = Vector2.new(screenPos.X, screenPos.Y)
                    l.Color = espCol
                else
                    if ESP_Lines[p] then ESP_Lines[p].Visible = false end
                end

                local highlight = p.Character:FindFirstChild("Deathbyte_ESP") or Instance.new("Highlight", p.Character)
                highlight.Name = "Deathbyte_ESP"
                highlight.Enabled = State.Visuals.Boxes
                highlight.FillColor = espCol
                highlight.OutlineColor = Color3.new(1,1,1)
            end
        end
    end
end)

UserInputService.JumpRequest:Connect(function()
    if State.Movement.InfJump and LocalPlayer.Character then
        LocalPlayer.Character.Humanoid:ChangeState("Jumping")
    end
end)

InitializeGunMods()
print("DEATHBYTE v4.0 LOADED - 100+ FEATURES ACTIVE")
