if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local Obsidian = loadstring(game:HttpGet("https://raw.githubusercontent.com/deividcomsono/Obsidian/main/Library.lua"))()

local State = {
    Combat = {
        Aimbot = false, SilentAim = false, Triggerbot = false, 
        Smoothing = 0.05, FOV = 100, ShowFOV = true, 
        TargetPart = "Head", VisibleCheck = true, TeamCheck = true,
        HitChance = 100, Prediction = 0.165, AutoFire = false
    },
    Visuals = {
        Enabled = false, Boxes = false, Skeletons = false, 
        Names = false, Health = false, Tracers = false, 
        Distance = false, Rainbow = true, Chams = false,
        HeadDots = false, LookLines = false, ViewFOV = 70
    },
    Guns = {
        NoRecoil = false, NoSpread = false, FastReload = false, 
        UnlockSkins = false, RapidFire = false, InfiniteAmmo = false,
        InstaHit = false, LongMelee = false
    },
    Movement = {
        Speed = 16, Jump = 50, InfJump = false, Noclip = false, 
        Fly = false, FlySpeed = 50, Bhop = false, AutoSprint = true
    },
    World = {
        Fullbright = false, NoFog = false, Exposure = 0.5, 
        Gravity = 196.2, CustomTime = false, Time = 12
    }
}

local ESP_Objects = {}
local FOV_Circle = Drawing.new("Circle")
FOV_Circle.Thickness = 1
FOV_Circle.NumSides = 32

local function GetTarget()
    local target = nil
    local dist = State.Combat.FOV
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild(State.Combat.TargetPart) then
            if State.Combat.TeamCheck and p.Team == LocalPlayer.Team then continue end
            
            local part = p.Character[State.Combat.TargetPart]
            local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
            
            if onScreen then
                local mouseDist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
                if mouseDist < dist then
                    if State.Combat.VisibleCheck then
                        local ray = Camera:ViewportPointToRay(pos.X, pos.Y)
                        local hit = Workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, Camera})
                        if hit and not hit:IsDescendantOf(p.Character) then continue end
                    end
                    dist = mouseDist
                    target = p
                end
            end
        end
    end
    return target
end

local oldIndex
oldIndex = hookmetamethod(game, "__index", function(self, key)
    if not checkcaller() then
        if key == "Clips" and State.Guns.InfiniteAmmo then return 999 end
        if key == "Recoil" and State.Guns.NoRecoil then return 0 end
        if key == "Spread" and State.Guns.NoSpread then return 0 end
    end
    return oldIndex(self, key)
end)

task.spawn(function()
    while task.wait(5) do
        if State.Guns.UnlockSkins then
            pcall(function()
                local PlayerData = ReplicatedStorage:FindFirstChild("PlayerData")
                if PlayerData then
                    local Inventory = PlayerData:FindFirstChild(LocalPlayer.Name)
                    if Inventory then
                        for _, v in ipairs(Inventory:GetDescendants()) do
                            if v:IsA("BoolValue") and (v.Name == "Unlocked" or v.Name == "Owned") then
                                v.Value = true
                            end
                        end
                    end
                end
            end)
        end
    end
end)

local Window = Obsidian.new("DEATHBYTE RIVALS | v4.0 FIX")

local TabC = Window:Tab("Combat")
TabC:Section("Aimbot")
TabC:Toggle("Aimbot Enabled", function(s) State.Combat.Aimbot = s end)
TabC:Toggle("Silent Aim", function(s) State.Combat.SilentAim = s end)
TabC:Slider("Smoothness", 1, 100, 5, function(v) State.Combat.Smoothing = v/100 end)
TabC:Slider("FOV Size", 30, 800, 100, function(v) State.Combat.FOV = v end)
TabC:Dropdown("Target Part", {"Head", "HumanoidRootPart"}, function(v) State.Combat.TargetPart = v end)
TabC:Toggle("Visible Check", function(s) State.Combat.VisibleCheck = s end)
TabC:Toggle("Team Check", function(s) State.Combat.TeamCheck = s end)

local TabV = Window:Tab("Visuals")
TabV:Toggle("Master Switch", function(s) State.Visuals.Enabled = s end)
TabV:Toggle("Box ESP", function(s) State.Visuals.Boxes = s end)
TabV:Toggle("Tracers", function(s) State.Visuals.Tracers = s end)
TabV:Toggle("Rainbow Mode", function(s) State.Visuals.Rainbow = s end)
TabV:Slider("Field of View", 70, 120, 70, function(v) Camera.FieldOfView = v end)

local TabG = Window:Tab("Guns")
TabG:Button("UNLOCK ALL SKINS", function() 
    State.Guns.UnlockSkins = true 
    Obsidian:Notification("Skins Spoofed", "All weapons unlocked locally!")
end)
TabG:Toggle("No Recoil", function(s) State.Guns.NoRecoil = s end)
TabG:Toggle("No Spread", function(s) State.Guns.NoSpread = s end)
TabG:Toggle("Infinite Ammo", function(s) State.Guns.InfiniteAmmo = s end)
TabG:Toggle("Rapid Fire", function(s) State.Guns.RapidFire = s end)

local TabM = Window:Tab("Movement")
TabM:Slider("Walkspeed", 16, 200, 16, function(v) State.Movement.Speed = v end)
TabM:Toggle("Noclip", function(s) State.Movement.Noclip = s end)
TabM:Toggle("Infinite Jump", function(s) State.Movement.InfJump = s end)
TabM:Toggle("Fly", function(s) State.Movement.Fly = s end)

local TabW = Window:Tab("World")
TabW:Toggle("Fullbright", function(s) State.World.Fullbright = s end)
TabW:Slider("Gravity", 0, 196, 196, function(v) Workspace.Gravity = v end)

RunService.RenderStepped:Connect(function()
    local rainbow = Color3.fromHSV(tick() % 5 / 5, 1, 1)
    local espCol = State.Visuals.Rainbow and rainbow or Color3.new(1,1,1)

    FOV_Circle.Visible = State.Combat.ShowFOV
    FOV_Circle.Radius = State.Combat.FOV
    FOV_Circle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOV_Circle.Color = espCol

    local target = GetTarget()
    if target and target.Character then
        local aimPart = target.Character[State.Combat.TargetPart]
        local aimPos = aimPart.Position
        
        if State.Combat.Prediction > 0 then
            aimPos = aimPos + (aimPart.Velocity * State.Combat.Prediction)
        end

        if State.Combat.Aimbot then
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, aimPos), State.Combat.Smoothing)
        end
    end

    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = State.Movement.Speed
        
        if State.Movement.Noclip then
            for _, v in ipairs(LocalPlayer.Character:GetChildren()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end

        if State.Movement.Fly then
            local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if root then
                root.Velocity = Vector3.new(0, 0.1, 0)
            end
        end
    end

    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            
            if State.Visuals.Enabled and root then
                local screenPos, onScreen = Camera:WorldToViewportPoint(root.Position)
                
                local highlight = p.Character:FindFirstChild("DB_Highlight")
                if State.Visuals.Boxes or State.Visuals.Chams then
                    if not highlight then
                        highlight = Instance.new("Highlight", p.Character)
                        highlight.Name = "DB_Highlight"
                    end
                    highlight.Enabled = true
                    highlight.FillColor = espCol
                elseif highlight then
                    highlight.Enabled = false
                end

                if State.Visuals.Tracers and onScreen then
                    if not ESP_Objects[p] then
                        ESP_Objects[p] = Drawing.new("Line")
                        ESP_Objects[p].Thickness = 1.5
                    end
                    local l = ESP_Objects[p]
                    l.Visible = true
                    l.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    l.To = Vector2.new(screenPos.X, screenPos.Y)
                    l.Color = espCol
                elseif ESP_Objects[p] then
                    ESP_Objects[p].Visible = false
                end
            else
                if ESP_Objects[p] then ESP_Objects[p].Visible = false end
                local h = p.Character:FindFirstChild("DB_Highlight")
                if h then h.Enabled = false end
            end
        end
    end

    if State.World.Fullbright then
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
    end
end)

UserInputService.JumpRequest:Connect(function()
    if State.Movement.InfJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid:ChangeState("Jumping")
    end
end)

print("DEATHBYTE v4.0 LOADED")
